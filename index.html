<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Album Pinterest Style</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
<!-- Polices Google Fonts gratuites -->
<link href="https://fonts.googleapis.com/css2?family=Roboto&family=Montserrat&family=Lobster&family=Open+Sans&display=swap" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; display:flex; justify-content:center; padding:20px; }
.controls { width:300px; margin-right:40px; }
.controls input, .controls textarea, .controls select, .controls button { width:100%; margin:8px 0; padding:8px; font-size:14px; }
.color-palette { display:flex; flex-wrap:wrap; gap:8px; margin:8px 0; align-items:center; }
.color-circle { width:30px; height:30px; border-radius:50%; cursor:pointer; border:2px solid white; box-shadow:0 0 2px rgba(0,0,0,0.5); }
.album-container { width:400px; height:650px; background:#fff; border-radius:0; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.2); padding:10px; box-sizing:border-box; display:flex; flex-direction:column; }
.cover-image { width:100%; height:50%; border-radius:0; overflow:hidden; background:#111; margin-bottom:10px; display:flex; justify-content:center; align-items:center; position: relative; }
.cover-image img { max-width:100%; max-height:100%; object-fit:contain; display:block; cursor:move; }
.cropper-message { position:absolute; top:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); color:white; padding:5px 10px; border-radius:5px; font-size:14px; z-index:10; pointer-events:none; }
.album-info { flex:1; display:flex; flex-direction:column; gap:5px; }
.title-row { display:flex; align-items:flex-end; gap:8px; }
.album-title { font-size:32px; font-weight:bold; text-transform:uppercase; }
.date { font-size:14px; opacity:0.7; }
.album-artist { font-size:16px; color:#333; }
.tracklist { font-size:14px; opacity:0.8; display:flex; justify-content:space-between; }
#left-tracks, #right-tracks { width:48%; white-space:pre-wrap; }
#single-column { width:100%; margin-top:5px; font-size:14px; opacity:0.8; white-space:pre-wrap; }
button { cursor:pointer; background:#111; color:white; border:none; border-radius:5px; }
button:hover { background:#333; }
</style>
</head>
<body>

<div class="controls">
  <h2>Créer ton album cover</h2>
  <input id="title" placeholder="Titre de l'album (obligatoire)" required>
  <input id="artist" placeholder="Nom de l'artiste (facultatif)">
  <input id="year" placeholder="Année (facultatif)">
  <textarea id="tracks" placeholder="Liste des chansons en deux colonnes (facultatif)"></textarea>
  <label>Taille texte liste chansons:</label>
  <input type="number" id="tracks-size" value="14" min="8" max="50">

  <label>Police liste chansons:</label>
  <select id="tracks-font">
    <option value="Roboto">Roboto</option>
    <option value="Montserrat">Montserrat</option>
    <option value="Lobster">Lobster</option>
    <option value="Open Sans">Open Sans</option>
  </select>

  <textarea id="singleText" placeholder="Texte en une seule colonne (facultatif)"></textarea>
  <label>Taille texte colonne unique:</label>
  <input type="number" id="single-size" value="14" min="8" max="50">

  <label>Police texte colonne unique:</label>
  <select id="single-font">
    <option value="Roboto">Roboto</option>
    <option value="Montserrat">Montserrat</option>
    <option value="Lobster">Lobster</option>
    <option value="Open Sans">Open Sans</option>
  </select>

  <input type="file" id="bgImage" accept="image/png, image/jpeg, image/jpg">

  <h4>Choisir la couleur du fond :</h4>
  <div class="color-palette">
    <div class="color-circle" style="background:#e63946" onclick="changeBackground('#e63946')"></div>
    <div class="color-circle" style="background:#f1faee" onclick="changeBackground('#f1faee')"></div>
    <div class="color-circle" style="background:#a8dadc" onclick="changeBackground('#a8dadc')"></div>
    <div class="color-circle" style="background:#457b9d" onclick="changeBackground('#457b9d')"></div>
    <div class="color-circle" style="background:#ffbe0b" onclick="changeBackground('#ffbe0b')"></div>
    <div class="color-circle" style="background:#ff006e" onclick="changeBackground('#ff006e')"></div>
    <label style="display:flex; align-items:center; gap:5px; font-size:14px;">
      Choisir n'importe quelle couleur :
      <input type="color" id="fullColorPicker" value="#ffffff" 
             onchange="changeBackground(this.value)" style="cursor:pointer; width:40px; height:30px; border:none; padding:0;">
    </label>
  </div>

  <button onclick="generate()">Générer la cover</button>
  <button id="finish-crop" onclick="finishCrop()" style="display:none;">Terminé de rogner</button>
  <button onclick="downloadCover()">Télécharger en PNG</button>
</div>

<div class="album-container" id="album">
  <div class="cover-image" id="cover-image"></div>
  <div class="album-info">
    <div class="title-row">
      <div class="album-title" id="album-title">Titre</div>
      <div class="date" id="album-year"></div>
    </div>
    <div class="album-artist" id="album-artist"></div>
    <div class="tracklist">
      <div id="left-tracks"></div>
      <div id="right-tracks"></div>
    </div>
    <div id="single-column"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
let selectedColor = '#fff';
let cropperInstance = null;

function changeBackground(color){
  selectedColor=color;
  document.getElementById("album").style.background=selectedColor;
}

function generate(){
  const title = document.getElementById("title").value.trim();
  if(!title){ alert("Le titre de l'album est obligatoire !"); return; }

  const artist = document.getElementById("artist").value.trim();
  const year = document.getElementById("year").value.trim();
  const tracks = document.getElementById("tracks").value.split('\n').filter(t=>t.trim()!=="");
  const singleText = document.getElementById("singleText").value;

  const tracksSize = document.getElementById("tracks-size").value;
  const tracksFont = document.getElementById("tracks-font").value;
  const singleSize = document.getElementById("single-size").value;
  const singleFont = document.getElementById("single-font").value;

  document.getElementById("album-title").innerText = title;
  document.getElementById("album-artist").innerText = artist || '';
  document.getElementById("album-year").innerText = year || '';

  const leftTracks = document.getElementById("left-tracks");
  const rightTracks = document.getElementById("right-tracks");
  leftTracks.style.fontSize = tracksSize+'px';
  rightTracks.style.fontSize = tracksSize+'px';
  leftTracks.style.fontFamily = tracksFont;
  rightTracks.style.fontFamily = tracksFont;

  if(tracks.length>0){
    const middle = Math.ceil(tracks.length/2);
    leftTracks.innerHTML = tracks.slice(0,middle).join('<br>');
    rightTracks.innerHTML = tracks.slice(middle).join('<br>');
  } else { leftTracks.innerHTML=''; rightTracks.innerHTML=''; }

  const singleColumn = document.getElementById("single-column");
  singleColumn.innerHTML = singleText || '';
  singleColumn.style.fontSize = singleSize+'px';
  singleColumn.style.fontFamily = singleFont;

  const bgFile = document.getElementById("bgImage").files[0];
  const coverDiv = document.getElementById("cover-image");
  coverDiv.innerHTML='';

  if(bgFile && bgFile.type.startsWith("image/")){
    const reader = new FileReader();
    reader.onload = function(e){
      const img = document.createElement('img');
      img.src = e.target.result;
      coverDiv.appendChild(img);

      const msg = document.createElement('div');
      msg.className='cropper-message';
      msg.innerText='Déplacez et zoomez votre image, puis cliquez sur Terminé de rogner';
      coverDiv.appendChild(msg);

      if(cropperInstance) cropperInstance.destroy();
      cropperInstance = new Cropper(img, {
        aspectRatio: coverDiv.offsetWidth / coverDiv.offsetHeight,
        viewMode: 1,
        movable: true,
        zoomable: true,
        rotatable: true,
        autoCropArea: 1,
        dragMode: 'move'
      });

      document.getElementById("finish-crop").style.display='inline-block';
    }
    reader.readAsDataURL(bgFile);
  } else { coverDiv.style.background = selectedColor; }
}

function finishCrop(){
  if(cropperInstance){
    const croppedCanvas = cropperInstance.getCroppedCanvas();
    const coverDiv = document.getElementById("cover-image");
    coverDiv.innerHTML = '';
    const img = document.createElement('img');
    img.src = croppedCanvas.toDataURL();
    coverDiv.appendChild(img);

    cropperInstance.destroy();
    cropperInstance = null;

    const msg = coverDiv.querySelector('.cropper-message');
    if(msg) msg.remove();

    document.getElementById("finish-crop").style.display='none';
  }
}

function downloadCover(){
  const album = document.getElementById("album");
  const clone = album.cloneNode(true);
  clone.style.transform='scale(1)';
  clone.style.boxShadow='none';
  clone.style.position='absolute';
  clone.style.top='-10000px';
  clone.style.left='-10000px';
  document.body.appendChild(clone);

  html2canvas(clone, {scale:3,useCORS:true,allowTaint:true,backgroundColor:null}).then(canvas=>{
    const link = document.createElement('a');
    link.download='album-cover.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
    document.body.removeChild(clone);
  });
}
</script>
</body>
</html>
